// async & await
// clear style of using promise :)
// promise chainingì´ ëŠ˜ì–´ë‚  ê²½ìš° ë³µì¡í•  ìˆ˜ ìˆëŠ”ë°,
// ê·¸ ìœ„ì— async/await apië¥¼ ì´ìš©í•˜ë©´ ë™ê¸°ì‹ ì‘ì„±ë²•ì²˜ëŸ¼ ê°„ë‹¨í•˜ê²Œ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.

const { reject } = require("async");

// 1. async
// ë§Œì•½ì— ì•„ë˜ì™€ ê°™ì€ ì½”ë”© ì•„ë˜ ë¸Œë¼ìš°ì €ë¥¼ ë„ìš°ëŠ” ë¡œì§ì´ ì§œì—¬ì ¸ ìˆë‹¤ë©´,
// ì‚¬ìš©ìëŠ” 10ì´ˆ ë™ì•ˆ ë¹ˆí˜ì´ì§€ë§Œ ë³´ê³  ìˆê²Œ ëœë‹¤.
function fetchUser(){
    // do network request in 10 secs...
    return 'ellie';
}
const user = fetchUser();
console.log(user);

// Promise ì´ìš©
function fetchUser(){
    return new Promise((resolve, reject) => {
        // do network request in 10 secs...
        resolve('ellie');   
        // resolve ì—†ì´ return ì‹œì—ëŠ” consoleì— ì°ì—ˆì„ ë•Œ pendingìœ¼ë¡œ ë‚˜íƒ€ë‚œë‹¤.(state: pending, result: undefined)
        // resolveë¥¼ ì ì–´ì£¼ë©´, state: fulfilled, result: ellie
    });
}
user = fetchUser();
user.then(console.log);
console.log(user);

// asyncë¥¼ ì ìš©í•˜ë©´ ì¡°ê¸ˆ ë” ê°„ë‹¨í•˜ê²Œ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.
async function fetchUser() {
    // do network reqeust in 10 secs....
    return 'ellie';
}
  
user = fetchUser();
user.then(console.log);
console.log(user);
  
// 2. await âœ¨
// asyncê°€ ë¶™ì€ í•¨ìˆ˜ ì•ˆì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥
function delay(ms) {
   return new Promise(resolve => setTimeout(resolve, ms));
}
  
async function getApple() {
   await delay(2000);
   return 'ğŸ';
}
  
async function getBanana() {
   await delay(1000);
   return 'ğŸŒ';
}
// ë™ì¼í•œ getBanana() í•¨ìˆ˜ì§€ë§Œ promiseë¥¼ ì‚¬ìš©í•˜ëŠ” í•¨ìˆ˜ë¡œ ë§Œë“¤ë©´,
function getBanana() {
    return delay(3000)
    .then(()=> 'ğŸŒ');
}

// ì‚¬ê³¼ì™€ ë°”ë‚˜ë‚˜ë¥¼ ëª¨ë‘ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ë¥¼ promiseë¡œ ë§Œë“ ë‹¤ë©´?
function pickFruits() {
    return getApple().then(apple => {
        return getBanana().then(banana => `${apple} + ${banana}`);
    });
} 
pickFruits().then(console.log);
// ì¤‘ì²©ëœ promise chainingì€ ì½œë°±ì§€ì˜¥ê³¼ ë‹¤ë¥¼ë°”ê°€ ì—†ìŒ
  
// ì´ ë•Œ asyncì™€ awaitì„ ì´ìš©í•˜ì—¬ ë™ê¸°ì‹ ì‘ì„±ë²•ìœ¼ë¡œ ì‘ì„± ê°€ëŠ¥!
async function pickFruits(){
    const apple = await getApple();
    const banana = await getBanana();
    return `${apple} + ${banana}`;
}
pickFruits().then(console.log);

// ë‹¤ë§Œ 1ì´ˆ ê¸°ë‹¤ë ¤ì„œ ì• í”Œì„ ê°€ì ¸ì˜¨ ë’¤ ë‹¤ì‹œ 1ì´ˆë¥¼ ê¸°ë‹¤ë ¤ì„œ ë°”ë‚˜ë‚˜ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê³¼ì •ì€,
// ë‘ ê³¼ì •ì´ ì„œë¡œ ì—°ê´€ì´ ì—†ëŠ” ê³¼ì •ì´ê¸° ë•Œë¬¸ì— ë¹„íš¨ìœ¨ì ì´ë‹¤.

async function pickFruits() {
    const applePromise = getApple();    // PromiseëŠ” ë§Œë“œëŠ” ìˆœê°„ ì‹¤í–‰ë¨
    const bananaPromise = getBanana();  // ë”°ë¼ì„œ Promiseë¥¼ ë¨¼ì € ë§Œë“¤ê³ 
    const apple = await applePromise;   // < ì´ì™€ ê°™ì´ ì‘ì„±í•¨ìœ¼ë¡œì¨
    const banana = await bananaPromise; // ë³‘ë ¬ ì‹¤í–‰ì´ ê°€ëŠ¥í•´ì§
    return `${apple} + ${banana}`;
}
pickFruits().then(console.log);
  
// 3. useful APIs âœ¨
// Promiseì˜ all() API
// Promiseì— ë°°ì—´ì„ ì „ë‹¬í•˜ê²Œ ë˜ë©´ ëª¨ë“  Promiseë“¤ì´ ë³‘ë ¬ì ìœ¼ë¡œ ë‹¤ ë°›ì„ ë•Œê¹Œì§€ ëª¨ì•„ì¤€ë‹¤
function pickAllFruits() {
    return Promise.all([getApple(), getBanana()]).then(fruits =>
        fruits.join(' + ')
    );
}
pickAllFruits().then(console.log);
  
// Promiseì˜ race() API
// Promiseì— ë°°ì—´ì„ ì „ë‹¬í•˜ë©´, ê·¸ ì¤‘ ê°€ì¥ ë¹¨ë¦¬ ê°’ì„ ì „ë‹¬í•˜ëŠ” Promise ê°’ë§Œ ì „ë‹¬ 
function pickOnlyOne() {
    return Promise.race([getApple(), getBanana()]);
}  
pickOnlyOne().then(console.log);